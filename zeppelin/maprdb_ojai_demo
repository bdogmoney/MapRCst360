{"paragraphs":[{"text":"%md ### Demonstration of the MapR-DB OJAI Connector for Apache Spark\n<p><img src=\"https://maprdocs.mapr.com/home/Spark/images/native_connector_batch_image.png\" style=\"width: 500px;\"/></p>\nFor more information see [https://maprdocs.mapr.com/home/Spark/NativeSparkConnectorJSON.html](https://maprdocs.mapr.com/home/Spark/NativeSparkConnectorJSON.html)","user":"anonymous","dateUpdated":"2017-09-08T15:40:25-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Demonstration of the MapR-DB OJAI Connector for Apache Spark</h3>\n<p><img src=\"https://maprdocs.mapr.com/home/Spark/images/native_connector_batch_image.png\" style=\"width: 500px;\"/></p>\n<p>For more information see <a href=\"https://maprdocs.mapr.com/home/Spark/NativeSparkConnectorJSON.html\">https://maprdocs.mapr.com/home/Spark/NativeSparkConnectorJSON.html</a></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1504909421374_-1788874473","id":"20170908-152341_211968492","dateCreated":"2017-09-08T15:23:41-0700","dateStarted":"2017-09-08T15:40:25-0700","dateFinished":"2017-09-08T15:40:25-0700","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:29942"},{"title":"Load an RDD from a table in MapR-DB","text":"import com.fasterxml.jackson.annotation.{JsonIgnoreProperties, JsonProperty}\nimport org.apache.spark.{SparkConf, SparkContext}\nimport com.mapr.db.spark._\n\nval startTotal=System.currentTimeMillis();\nval allRows = sc.loadFromMapRDB(\"/mapr/my.cluster.com/tmp/crm_data\").select(\"_id\");\nval start=System.currentTimeMillis();\nprint(\"Number of documents:\" +  allRows.count() );\nval end = System.currentTimeMillis();\nprint(\" (in \"+ (end-start) + \" ms)\"  +\"\\n\");\nprint(\"\\t (in \"+ (end-startTotal) + \" ms with Spark pre-processing work)\"  +\"\\n\\n\");","user":"anonymous","dateUpdated":"2017-09-14T09:45:23-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport com.fasterxml.jackson.annotation.{JsonIgnoreProperties, JsonProperty}\n\nimport org.apache.spark.{SparkConf, SparkContext}\n\nimport com.mapr.db.spark._\n\nstartTotal: Long = 1504910476843\n\nallRows: com.mapr.db.spark.RDD.MapRDBTableScanRDD[com.mapr.db.spark.impl.OJAIDocument] = MapRDBTableScanRDD[11] at RDD at MapRDBBaseRDD.scala:17\n\nstart: Long = 1504910477140\nNumber of documents:100000\nend: Long = 1504910478860\n (in 1720 ms)\n\t (in 2017 ms with Spark pre-processing work)\n\n"}]},"apps":[],"jobName":"paragraph_1504909242739_-1168368086","id":"20170908-152042_1792557024","dateCreated":"2017-09-08T15:20:42-0700","dateStarted":"2017-09-08T15:41:16-0700","dateFinished":"2017-09-08T15:41:19-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:29943"},{"title":"Load an RDD from MapR Streams","text":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.types._\nimport org.apache.kafka.clients.consumer.ConsumerConfig\nimport org.apache.spark.SparkConf\nimport org.apache.spark.streaming.{ Seconds, StreamingContext }\nimport org.apache.spark.streaming.kafka09.{ ConsumerStrategies, KafkaUtils, LocationStrategies }\nimport org.apache.spark.streaming.dstream.DStream\n\nvar topicsSet: Set[String] = Set()\ntopicsSet = \"mytopic1, mytopic2\".split(\",\").toSet\nval brokers = \"localhost:9092\" // not needed for MapR Streams, needed for Kafka\nval groupId = \"SparkStreamingExample\"\nval batchInterval = \"2\"\nval pollTimeout = \"10000\"\nval sparkConf = new SparkConf().setAppName(\"SparkStreamApp\")\nval ssc = new StreamingContext(sparkConf, Seconds(batchInterval.toInt))\nval kafkaParams = Map[String, String](\n    ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -> brokers,\n    ConsumerConfig.GROUP_ID_CONFIG -> groupId,\n    ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG ->\n        \"org.apache.kafka.common.serialization.StringDeserializer\",\n    ConsumerConfig.AUTO_OFFSET_RESET_CONFIG -> \"latest\",\n    ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG ->\n        \"org.apache.kafka.common.serialization.StringDeserializer\",\n    ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG -> \"true\")\nval consumerStrategy = ConsumerStrategies.Subscribe[String, String](topicsSet, kafkaParams)\nval messagesDStream = KafkaUtils.createDirectStream[String, String](ssc, LocationStrategies.PreferConsistent, consumerStrategy)\n// get message values from key,value\nval valuesDStream: DStream[String] = messagesDStream.map(_.value())\nprintln(\"Waiting for messages...\")\nvaluesDStream.foreachRDD { rdd =>\n  if (!rdd.isEmpty) {\n    val count = rdd.count\n    println(\"consumed \" + count + \" records\")\n    val spark = SparkSession\n      .builder()\n      .appName(\"SparkSessionTicks\")\n      .config(rdd.sparkContext.getConf)\n      .enableHiveSupport()\n      .getOrCreate()\n    import spark.implicits._\n    val df = rdd.map(parseTick).toDF()\n    if (VERBOSE) {\n      // Display the top 20 rows of DataFrame\n      df.printSchema()\n      df.show()\n    }","user":"anonymous","dateUpdated":"2017-09-14T09:45:19-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1504910573622_-1709790820","id":"20170908-154253_1434777901","dateCreated":"2017-09-08T15:42:53-0700","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:29944"}],"name":"MapR-DB OJAI Connector for Spark","id":"2CSM7E15N","angularObjects":{"2CTJ612MA:shared_process":[],"2CSSF2TSA:shared_process":[],"2CTV8579E:shared_process":[],"2CT61WH1H:shared_process":[],"2CR1GS1SU:shared_process":[],"2CSS5NKC3:shared_process":[],"2CSN2T9YW:shared_process":[],"2CTNAY1B6:shared_process":[],"2CUF3XRMG:shared_process":[],"2CRN6B13X:shared_process":[],"2CSGC5REF:shared_process":[],"2CRP8PR6Z:shared_process":[],"2CREDPWY9:shared_process":[],"2CQSHATVV:shared_process":[],"2CT8Y5X61:shared_process":[],"2CU4B4UXF:shared_process":[],"2CQT4K7YB:shared_process":[],"2CSRE32HD:shared_process":[],"2CR5HE1EK:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}